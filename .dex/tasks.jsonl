{"id":"bpb4f298","parent_id":null,"name":"dotagents Specification","description":"# dotagents Specification\n\n## Overview\n\ndotagents is a package manager for `.agents` directories. It manages agent skill dependencies using the [agentskills.io](https://agentskills.io) standard, providing reproducible installs, a lockfile, and symlinks so that multiple agent tools (Claude Code, Cursor, Codex, etc.) can discover skills from a single canonical location.\n\nThink of it as npm for agent skills: you declare dependencies in `agents.toml`, run `dotagents install`, and skills appear in `.agents/skills/` with symlinks into each tool's expected directory.\n\n### Why\n\nAgent skills are currently distributed as loose folders copied from git repos. There's no dependency management, no lockfile, no way to keep skills updated across a team. dotagents fills this gap.\n\n### Key Principles\n\n- **`.agents/skills/` is the canonical home** for all skills (managed and custom)\n- **`agents.toml`** declares what you want; **`agents.lock`** pins what you have\n- **Selective gitignore**: managed skills are gitignored, custom skills are tracked\n- **Subdirectory symlinks**: `.claude/skills/ -> .agents/skills/`, not full directory symlinks\n- **agentskills.io format**: skills are folders with a `SKILL.md` file containing YAML frontmatter\n\n---\n\n## agents.toml\n\nThe manifest file. Lives at the project root.\n\n### Schema\n\n```toml\nversion = 1\n\n[project]\nname = \"my-project\"              # Optional. For display purposes.\n\n[symlinks]\ntargets = [\".claude\", \".cursor\"] # Creates <target>/skills/ -> .agents/skills/\n\n[skills]\n# Each skill is a TOML table keyed by the skill name.\n\n[skills.pdf-processing]\nsource = \"github:anthropics/skills/pdf-processing\"\nref = \"v1.2.0\"\n\n[skills.find-bugs]\nsource = \"github:getsentry/sentry-skills/find-bugs\"\nref = \"main\"\n\n[skills.code-review]\nsource = \"@anthropics/code-review\"\n\n[skills.internal-review]\nsource = \"git:https://git.corp.example.com/team/skills.git\"\npath = \"internal-review\"\nref = \"v2.0.0\"\n\n[skills.my-custom-skill]\nsource = \"path:../shared-skills/my-custom-skill\"\n```\n\n### Fields\n\n#### Top-level\n\n| Field | Required | Description |\n|-------|----------|-------------|\n| `version` | Yes | Schema version. Always `1`. |\n| `project` | No | Project metadata. |\n| `symlinks` | No | Symlink configuration. |\n| `skills` | No | Skill dependencies (empty table if no dependencies). |\n\n#### `[project]`\n\n| Field | Required | Description |\n|-------|----------|-------------|\n| `name` | No | Project name for display. |\n\n#### `[symlinks]`\n\n| Field | Required | Description |\n|-------|----------|-------------|\n| `targets` | No | Array of directories to symlink. Each gets a `skills/` subdirectory pointing to `.agents/skills/`. Defaults to `[]`. |\n\n#### `[skills.<name>]`\n\n| Field | Required | Description |\n|-------|----------|-------------|\n| `source` | Yes | Skill source specifier (see Source Types below). |\n| `ref` | No | Git ref to pin to (tag, branch, or commit SHA). Defaults to the repo's default branch. |\n| `path` | No | Subdirectory within the git repo containing the skill. Only needed for `git:` sources where the URL doesn't encode the path. |\n\n### Source Types\n\n#### `github:<owner>/<repo>/<skill-path>`\n\nGitHub shorthand. Resolves to `https://github.com/<owner>/<repo>.git` with skill located at `<skill-path>/`.\n\n```toml\nsource = \"github:anthropics/skills/pdf-processing\"\n# -> clone https://github.com/anthropics/skills.git\n# -> use pdf-processing/ subdirectory\n```\n\n#### `git:<url>`\n\nFull git URL. Use `path` field to specify subdirectory.\n\n```toml\nsource = \"git:https://git.corp.example.com/team/skills.git\"\npath = \"my-skill\"\nref = \"main\"\n```\n\n#### `path:<relative-path>`\n\nLocal filesystem path, relative to the project root (where `agents.toml` lives).\n\n```toml\nsource = \"path:../shared-skills/my-custom-skill\"\n```\n\nLocal path skills are copied (not symlinked) into `.agents/skills/` during install. They have an integrity hash in the lockfile but no git commit. `dotagents install` re-copies if the source content has changed.\n\n#### `@<scope>/<name>`\n\nRegistry-style shorthand. Resolves using the following algorithm:\n\n1. Try `https://github.com/<scope>/skills.git`, look for a `<name>/SKILL.md` subdirectory\n2. If not found, try `https://github.com/<scope>/<name>.git` (dedicated skill repo)\n\n```toml\nsource = \"@anthropics/code-review\"\n# -> tries https://github.com/anthropics/skills.git, subdirectory code-review/\n# -> falls back to https://github.com/anthropics/code-review.git\n```\n\n---\n\n## agents.lock\n\nThe lockfile. Lives at the project root alongside `agents.toml`. TOML format.\n\n**This file is auto-generated.** Do not edit manually. Commit it to version control.\n\n### Format\n\n```toml\n# Auto-generated by dotagents. Do not edit.\nversion = 1\n\n[skills.pdf-processing]\nsource = \"github:anthropics/skills/pdf-processing\"\nresolved_url = \"https://github.com/anthropics/skills.git\"\nresolved_path = \"pdf-processing\"\nresolved_ref = \"v1.2.0\"\ncommit = \"a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2\"\nintegrity = \"sha256-Kx3bXjQ9mFpLw7rN8vYzTg==\"\n\n[skills.find-bugs]\nsource = \"github:getsentry/sentry-skills/find-bugs\"\nresolved_url = \"https://github.com/getsentry/sentry-skills.git\"\nresolved_path = \"find-bugs\"\nresolved_ref = \"main\"\ncommit = \"b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3\"\nintegrity = \"sha256-Lm4cYkR0nGqMx8sO9wZaUh==\"\n\n[skills.my-custom-skill]\nsource = \"path:../shared-skills/my-custom-skill\"\nintegrity = \"sha256-No6eAmT2pIsOz0uQ1yBcWj==\"\n```\n\n### Fields per skill\n\n| Field | Present For | Description |\n|-------|-------------|-------------|\n| `source` | All | Original source specifier from agents.toml. |\n| `resolved_url` | Git sources | Resolved git clone URL. |\n| `resolved_path` | Git sources | Subdirectory within the repo. |\n| `resolved_ref` | Git sources | The ref that was resolved (tag/branch name). |\n| `commit` | Git sources | Full 40-char SHA of the resolved commit. This is the reproducibility guarantee. |\n| `integrity` | All | SHA-256 content hash of the installed skill directory. |\n\n### Integrity Hashing\n\nThe integrity hash is computed deterministically:\n\n1. Walk all files in the skill directory, sorted alphabetically by relative path\n2. For each file, compute SHA-256 of its contents\n3. Concatenate all `<relative-path>\\0<hex-hash>\\n` strings\n4. SHA-256 hash the concatenation\n5. Base64-encode and prefix with `sha256-`\n\n### Frozen Mode\n\n`dotagents install --frozen` (for CI):\n\n- Fails if `agents.lock` does not exist\n- Fails if any skill in `agents.toml` is missing from the lockfile\n- Fails if integrity hashes don't match after install\n- Does NOT modify the lockfile\n\n---\n\n## CLI Commands\n\nThe CLI binary is `dotagents`. Built with Bun for standalone distribution.\n\n### `dotagents init`\n\nInitialize a new project.\n\n```\ndotagents init [--force]\n```\n\n**Behavior:**\n1. Create `agents.toml` with `version = 1` and empty `[skills]` table\n2. Create `.agents/skills/` directory\n3. If any symlink targets are configured (or `.claude/` exists), set up symlinks\n4. Generate `.agents/.gitignore`\n5. Print next steps\n\n**Flags:**\n- `--force`: Overwrite existing `agents.toml`\n\n### `dotagents install`\n\nInstall all dependencies from `agents.toml`.\n\n```\ndotagents install [--frozen] [--force]\n```\n\n**Behavior:**\n1. Read `agents.toml`\n2. If `agents.lock` exists, use locked commits for resolution\n3. If `agents.lock` is missing (or `--force`), resolve all from sources\n4. For each skill:\n   a. Check global cache (`~/.local/dotagents/cache/`)\n   b. If not cached, clone/fetch the git repo\n   c. Copy skill directory into `.agents/skills/<name>/`\n   d. Verify integrity hash\n5. Write `agents.lock` (unless `--frozen`)\n6. Regenerate `.agents/.gitignore`\n7. Create/verify symlinks\n8. Print summary\n\n**Flags:**\n- `--frozen`: Fail if lockfile is stale. Do not modify lockfile. For CI.\n- `--force`: Re-download everything, ignore cache.\n\n### `dotagents add <specifier>`\n\nAdd a skill dependency.\n\n```\ndotagents add <specifier> [--ref <ref>] [--name <name>]\n```\n\n**Examples:**\n```bash\ndotagents add @anthropics/pdf-processing\ndotagents add github:getsentry/sentry-skills/find-bugs --ref v1.0.0\ndotagents add path:../shared-skills/my-skill\n```\n\n**Behavior:**\n1. Parse specifier to determine source type\n2. Resolve source (clone if needed, locate SKILL.md)\n3. Read skill name from SKILL.md frontmatter\n4. Add `[skills.<name>]` entry to `agents.toml`\n5. Install the skill\n6. Update `agents.lock`\n7. Regenerate `.agents/.gitignore`\n\n**Flags:**\n- `--ref <ref>`: Pin to a specific tag/branch/commit\n- `--name <name>`: Override the skill name (defaults to SKILL.md `name` field)\n\n### `dotagents remove <name>`\n\nRemove a skill dependency.\n\n```\ndotagents remove <name>\n```\n\n**Behavior:**\n1. Remove `[skills.<name>]` from `agents.toml`\n2. Delete `.agents/skills/<name>/`\n3. Remove entry from `agents.lock`\n4. Regenerate `.agents/.gitignore`\n\n### `dotagents update [<name>]`\n\nUpdate skills to latest versions within ref constraints.\n\n```\ndotagents update              # all skills\ndotagents update find-bugs    # one skill\n```\n\n**Behavior:**\n1. For each skill:\n   - If ref is a branch: fetch latest commit on that branch\n   - If ref is a tag: check for newer tags (semver-aware)\n   - If ref is a commit SHA: skip (immutable)\n2. Update `agents.lock` with new commits\n3. Re-install updated skills\n4. Print changelog (old commit -> new commit)\n\n### `dotagents sync`\n\nReconcile actual state with declared state.\n\n```\ndotagents sync\n```\n\n**Behavior:**\n1. Regenerate `.agents/.gitignore`\n2. Create/verify/repair symlinks\n3. Warn if managed skills are accidentally tracked in git\n4. Warn if orphaned skills exist (installed but not in agents.toml)\n5. Verify integrity hashes, warn on local modifications\n\n### `dotagents list`\n\nShow installed skills and status.\n\n```\ndotagents list [--json]\n```\n\n**Output columns:** name, source, installed commit (short SHA), status (up to date / outdated / modified / custom)\n\n---\n\n## Skill Resolution\n\nHow dotagents resolves a specifier to a concrete skill directory.\n\n### Resolution Flow\n\n```\nSpecifier\n  |\n  ├─ \"path:...\"     -> Resolve relative to project root\n  ├─ \"git:...\"      -> Parse URL, use `path` field for subdirectory\n  ├─ \"github:...\"   -> Parse owner/repo/path, construct git URL\n  └─ \"@scope/name\"  -> Try github:scope/skills/name, then github:scope/name\n        |\n        v\n  Clone/fetch git repo (or resolve local path)\n        |\n        v\n  Locate SKILL.md in resolved directory\n        |\n        v\n  Parse YAML frontmatter, validate name field\n        |\n        v\n  Return ResolvedSkill { url, path, ref, commit, name, metadata }\n```\n\n### Skill Validation\n\nA valid skill directory must contain:\n- `SKILL.md` with valid YAML frontmatter\n- Frontmatter must include `name` and `description` fields\n- `name` must match: lowercase letters, numbers, hyphens; max 64 chars; no leading/trailing/consecutive hyphens\n\nOptional directories: `scripts/`, `references/`, `assets/`\n\n---\n\n## Gitignore Strategy\n\nAll skills live in `.agents/skills/`. Managed (external) skills are gitignored. Custom (local) skills are tracked.\n\n### How It Works\n\ndotagents generates `.agents/.gitignore` listing every managed skill:\n\n```gitignore\n# Auto-generated by dotagents. Do not edit.\n# Managed skills (installed by dotagents)\n/skills/pdf-processing/\n/skills/find-bugs/\n/skills/code-review/\n```\n\nCustom skills in `.agents/skills/my-local-skill/` are NOT listed, so git tracks them normally.\n\n### Regeneration\n\n`.agents/.gitignore` is regenerated on every:\n- `dotagents install`\n- `dotagents add`\n- `dotagents remove`\n- `dotagents sync`\n\nThe list of managed skills is derived from `agents.toml` -- any skill with a non-`path:` source is considered managed. (`path:` sources could go either way; for now they are also gitignored since they're installed by dotagents.)\n\n### Edge Cases\n\n- **Custom skill name collides with managed skill**: `dotagents add` refuses to install if `.agents/skills/<name>/` already exists and is tracked by git\n- **Someone commits a managed skill**: `dotagents sync` detects this and warns\n\n---\n\n## Symlink Strategy\n\n### Problem\n\nEach agent tool has its own directory with tool-specific files:\n- `.claude/` -- `settings.json`, `commands/`, `skills/`\n- `.cursor/` -- `rules/`, `skills/`\n- `.codex/` -- `skills/`\n\nSymlinking the entire directory (e.g., `.claude/ -> .agents/`) would clobber tool-specific files.\n\n### Solution\n\nSymlink only the `skills/` subdirectory:\n\n```\n.claude/skills/  -> .agents/skills/\n.cursor/skills/  -> .agents/skills/\n```\n\n`.agents/skills/` is the canonical home. Each tool's `skills/` directory is a symlink.\n\n### Configuration\n\n```toml\n[symlinks]\ntargets = [\".claude\", \".cursor\"]\n```\n\nFor each target in the array, dotagents creates `<target>/skills/ -> .agents/skills/`.\n\n### Behavior\n\n- Parent directory (`.claude/`) is created if it doesn't exist\n- If `<target>/skills/` exists as a real directory, `dotagents init` offers to migrate its contents into `.agents/skills/` and replace with a symlink\n- If `<target>/skills/` is already a correct symlink, no action needed\n- `dotagents sync` verifies and repairs broken symlinks\n\n### Future Extensibility\n\nAs dotagents manages more resource types beyond skills, additional subdirectory symlinks can be added (e.g., `<target>/subagents/ -> .agents/subagents/`). The `[symlinks]` schema can grow to support this without breaking existing configs.\n\n---\n\n## Installation Flow\n\nWhat happens during `dotagents install`:\n\n```\n1. Read agents.toml\n   |\n2. Read agents.lock (if exists)\n   |\n3. For each skill in agents.toml:\n   |\n   ├─ In lockfile with matching source?\n   |  └─ YES: Use locked commit + integrity\n   |  └─ NO: Resolve from source (new or changed dependency)\n   |\n4. For each skill to install:\n   |\n   ├─ Check global cache (~/.local/dotagents/cache/)\n   |  ├─ HIT: Copy from cache\n   |  └─ MISS: Clone/fetch git repo\n   |\n   ├─ Extract skill directory (locate by path)\n   ├─ Validate SKILL.md\n   ├─ Compute integrity hash\n   ├─ Copy into .agents/skills/<name>/\n   └─ Update cache\n   |\n5. Write agents.lock\n6. Generate .agents/.gitignore\n7. Create/verify symlinks\n8. Print summary\n```\n\n### Global Cache\n\nLocation: `~/.local/dotagents/cache/`\n\nStructure:\n```\n~/.local/dotagents/cache/\n  github.com/\n    anthropics/\n      skills/\n        a1b2c3d4.../    # Cached at specific commit\n          pdf-processing/\n          code-review/\n    getsentry/\n      sentry-skills/\n        b2c3d4e5.../\n          find-bugs/\n```\n\nThe cache stores full repo clones (bare repos) to enable fast fetches. Skill directories are extracted from the cached repo at the locked commit.\n\n---\n\n## Build and Distribution\n\n### Bun Compile\n\nPrimary distribution: standalone binary with no runtime dependencies.\n\n```bash\nbun build src/cli/index.ts --compile --outfile dist/dotagents\n```\n\n### Platform Matrix\n\nBuild per-platform binaries via GitHub Actions:\n\n| Platform | Target |\n|----------|--------|\n| macOS arm64 | `darwin-arm64` |\n| macOS x64 | `darwin-x64` |\n| Linux x64 | `linux-x64` |\n| Linux arm64 | `linux-arm64` |\n\n### Distribution Channels\n\n1. **GitHub Releases**: Per-platform binaries attached to releases\n2. **Install script**: `curl -fsSL https://dotagents.dev/install.sh | sh` (detects platform, downloads binary)\n3. **npm** (fallback): `npx dotagents` for users with Node.js\n\n---\n\n## Project Source Layout\n\n```\ndotagents/\n  AGENTS.md                # Agent instructions\n  CLAUDE.md -> AGENTS.md   # Symlink\n  agents.toml              # Self-dogfooding (optional)\n  package.json\n  tsconfig.json\n  vitest.config.ts\n  .gitignore\n  specs/\n    SPEC.md                # This file\n  src/\n    index.ts               # Library entry point\n    cli/\n      index.ts             # CLI entry (Bun compile target)\n      commands/\n        init.ts\n        install.ts\n        add.ts\n        remove.ts\n        update.ts\n        sync.ts\n        list.ts\n      output/\n        reporter.ts        # TTY-aware console output\n    config/\n      schema.ts            # Zod schemas for agents.toml\n      loader.ts            # TOML parse + validate\n      writer.ts            # TOML modification (add/remove skills)\n    lockfile/\n      schema.ts            # Zod schemas for agents.lock\n      resolver.ts          # Compare agents.toml vs lockfile\n      writer.ts            # Serialize lockfile\n    skills/\n      loader.ts            # Parse SKILL.md (agentskills.io format)\n      resolver.ts          # Specifier -> ResolvedSource\n      installer.ts         # Orchestrate install flow\n    sources/\n      git.ts               # Git clone/fetch/checkout\n      local.ts             # Local path resolution\n      cache.ts             # Global cache management\n    symlinks/\n      manager.ts           # Create/verify/repair symlinks\n    gitignore/\n      writer.ts            # Generate .agents/.gitignore\n    types/\n      index.ts             # Shared types\n    utils/\n      exec.ts              # Child process execution\n      hash.ts              # SHA-256 content hashing\n      fs.ts                # Filesystem helpers\n```\n\n## Dependencies\n\n### Runtime\n\n| Package | Purpose |\n|---------|---------|\n| `smol-toml` | TOML parsing and serialization |\n| `zod` | Runtime schema validation |\n| `chalk` | Terminal colors |\n\n### Dev\n\n| Package | Purpose |\n|---------|---------|\n| `typescript` | Type checking |\n| `vitest` | Testing |\n| `eslint` | Linting |\n| `typescript-eslint` | TypeScript lint rules |\n| `tsx` | Dev-time TS execution |\n\nNo git library -- use `git` CLI directly. No heavy TUI framework.\n","priority":1,"completed":false,"result":null,"metadata":null,"created_at":"2026-02-07T17:58:54.374Z","updated_at":"2026-02-07T17:58:54.374Z","started_at":null,"completed_at":null,"blockedBy":[],"blocks":[],"children":["iashsswc","gbaj6w6t","qze9byy6","g6gl9kkc","ce1qxz3w","ib51q4f3","irdxowwf","srnjavhs","k746m3ok"]}
{"id":"ce1qxz3w","parent_id":"bpb4f298","name":"Install command","description":"Implement dotagents install -- the core command that installs all dependencies.\n\nFile: src/cli/commands/install.ts (+ orchestration in src/skills/installer.ts)\n\nFlow:\n1. Read agents.toml\n2. Read agents.lock (if exists)\n3. For each skill: use locked commit if available, else resolve from source\n4. For each skill to install: check cache -> fetch if miss -> validate SKILL.md -> compute integrity -> copy to .agents/skills/<name>/\n5. Write agents.lock\n6. Generate .agents/.gitignore\n7. Create/verify symlinks\n8. Print summary\n\nFlags:\n- --frozen: Fail if lockfile missing/stale. Don't write lockfile. For CI.\n- --force: Re-download everything, ignore cache.\n\nAcceptance criteria:\n- Fresh install (no lockfile) resolves, installs, and creates lockfile\n- Subsequent install with lockfile is fast (uses cache/locked commits)\n- --frozen fails if lockfile is missing or stale\n- .agents/.gitignore is generated listing managed skills\n- Symlinks are created per [symlinks] config","priority":1,"completed":false,"result":null,"metadata":null,"created_at":"2026-02-07T17:59:35.970Z","updated_at":"2026-02-07T18:00:11.505Z","started_at":null,"completed_at":null,"blockedBy":["irdxowwf"],"blocks":["ib51q4f3"],"children":[]}
{"id":"g6gl9kkc","parent_id":"bpb4f298","name":"Lockfile: agents.lock schema and resolver","description":"Implement the lockfile system for reproducible installs.\n\nFiles to create:\n- src/lockfile/schema.ts -- Zod schemas for agents.lock\n- src/lockfile/resolver.ts -- Compare agents.toml vs lockfile to determine what needs updating\n- src/lockfile/writer.ts -- Serialize lockfile to TOML\n- src/utils/hash.ts -- Deterministic SHA-256 content hashing for integrity field\n\nLockfile format (TOML):\n- version = 1\n- Per skill: source, resolved_url, resolved_path, resolved_ref, commit (40-char SHA), integrity (sha256-base64)\n- path: sources have integrity but no commit\n\nIntegrity hash algorithm:\n1. Walk files sorted alphabetically by relative path\n2. SHA-256 each file's contents\n3. Concatenate '<path>\\0<hex-hash>\\n' strings\n4. SHA-256 the concatenation, base64-encode, prefix with sha256-\n\nAcceptance criteria:\n- Can write and read back a lockfile round-trip\n- Resolver correctly identifies new, changed, and unchanged skills\n- Integrity hashes are deterministic (same content = same hash)","priority":1,"completed":false,"result":null,"metadata":null,"created_at":"2026-02-07T17:59:29.455Z","updated_at":"2026-02-07T18:00:09.529Z","started_at":null,"completed_at":null,"blockedBy":["qze9byy6"],"blocks":[],"children":[]}
{"id":"gbaj6w6t","parent_id":"bpb4f298","name":"CLI scaffold and init command","description":"Set up the CLI entry point and implement the first command: dotagents init.\n\nFiles to create:\n- src/cli/index.ts -- CLI entry point (Bun compile target), arg parsing with node:util parseArgs\n- src/cli/commands/init.ts -- The init command\n\ndotagents init behavior:\n1. Create agents.toml with version = 1 and empty [skills] table\n2. Create .agents/skills/ directory\n3. Generate .agents/.gitignore (initially empty managed section)\n4. Set up symlinks per [symlinks] config if present\n5. Print next steps\n\nFlags: --force (overwrite existing agents.toml)\n\nAcceptance criteria:\n- Running 'dotagents init' in an empty directory creates agents.toml and .agents/skills/\n- Running without --force when agents.toml exists prints error\n- Running with --force overwrites","priority":1,"completed":true,"result":"Refactored init command to accept projectRoot parameter for testability. Exported runInit() and InitError for direct testing. 9 integration tests covering: create config, create dirs, gitignore, --force overwrite, idempotency, no symlinks by default, preserves existing skills. All 47 tests passing.","metadata":null,"created_at":"2026-02-07T17:59:10.049Z","updated_at":"2026-02-07T18:37:55.626Z","started_at":"2026-02-07T18:37:55.626Z","completed_at":"2026-02-07T18:37:55.626Z","blockedBy":["iashsswc"],"blocks":[],"children":[]}
{"id":"iashsswc","parent_id":"bpb4f298","name":"Config system: agents.toml schema and loader","description":"Implement the agents.toml configuration system.\n\nFiles to create:\n- src/config/schema.ts -- Zod schemas for agents.toml (version, project, symlinks, skills with source types)\n- src/config/loader.ts -- Parse TOML with smol-toml, validate with Zod\n- src/config/writer.ts -- Add/remove skill entries in agents.toml, preserve formatting\n\nSource types to support: github:owner/repo/path, git:url, path:relative, @scope/name\n\nDependencies needed: smol-toml, zod\n\nAcceptance criteria:\n- Can parse a valid agents.toml and return typed config\n- Rejects invalid configs with clear error messages\n- Writer can add/remove [skills.name] sections without corrupting the file","priority":1,"completed":true,"result":"Implemented config system: schema.ts with Zod v4 validation for agents.toml (all source types), loader.ts with TOML parsing + error handling, writer.ts for add/remove/generate. 26 tests passing.","metadata":null,"created_at":"2026-02-07T17:59:04.046Z","updated_at":"2026-02-07T18:34:50.209Z","started_at":"2026-02-07T18:34:50.208Z","completed_at":"2026-02-07T18:34:50.209Z","blockedBy":[],"blocks":["gbaj6w6t","qze9byy6"],"children":[]}
{"id":"ib51q4f3","parent_id":"bpb4f298","name":"Add and remove commands","description":"Implement dotagents add and dotagents remove.\n\nFiles: src/cli/commands/add.ts, src/cli/commands/remove.ts\n\ndotagents add <specifier> [--ref <ref>] [--name <name>]:\n1. Parse specifier to determine source type\n2. Resolve source (clone if needed, locate SKILL.md)\n3. Read skill name from SKILL.md frontmatter\n4. Add [skills.<name>] entry to agents.toml via config writer\n5. Install the skill\n6. Update agents.lock\n7. Regenerate .agents/.gitignore\n\ndotagents remove <name>:\n1. Remove [skills.<name>] from agents.toml\n2. Delete .agents/skills/<name>/\n3. Remove from agents.lock\n4. Regenerate .agents/.gitignore\n\nEdge cases:\n- add refuses if name collides with a git-tracked custom skill\n- remove warns if the skill directory doesn't exist\n- add with --name overrides the SKILL.md name field\n\nAcceptance criteria:\n- Can add a skill from each source type and see it in agents.toml + lockfile + .agents/skills/\n- Can remove a skill and see it cleaned up from all three locations","priority":1,"completed":false,"result":null,"metadata":null,"created_at":"2026-02-07T17:59:41.898Z","updated_at":"2026-02-07T18:00:12.461Z","started_at":null,"completed_at":null,"blockedBy":["ce1qxz3w"],"blocks":["srnjavhs"],"children":[]}
{"id":"irdxowwf","parent_id":"bpb4f298","name":"Gitignore and symlink management","description":"Implement .agents/.gitignore generation and subdirectory symlink management.\n\nFiles:\n- src/gitignore/writer.ts -- Generate .agents/.gitignore listing managed skill directories\n- src/symlinks/manager.ts -- Create/verify/repair symlinks\n\nGitignore:\n- Auto-generated header comment\n- One /skills/<name>/ line per managed skill (non-path: sources)\n- Regenerated on every install/add/remove/sync\n\nSymlinks:\n- For each target in [symlinks].targets, create <target>/skills/ -> .agents/skills/\n- Parent directory created if missing\n- If <target>/skills/ exists as real directory, offer migration (move contents to .agents/skills/, replace with symlink)\n- Verify symlinks point to correct target, repair if broken\n\nAcceptance criteria:\n- .agents/.gitignore correctly lists only managed skills\n- Custom skills in .agents/skills/ are NOT gitignored\n- .claude/skills/ is a working symlink to .agents/skills/\n- Broken symlinks are detected and repaired by sync","priority":1,"completed":true,"result":"Implemented gitignore writer (auto-generated .agents/.gitignore with sorted managed skills) and symlink manager (create/verify/repair subdirectory symlinks with migration support). 12 tests passing.","metadata":null,"created_at":"2026-02-07T17:59:51.328Z","updated_at":"2026-02-07T18:34:52.160Z","started_at":"2026-02-07T18:34:52.159Z","completed_at":"2026-02-07T18:34:52.160Z","blockedBy":[],"blocks":["ce1qxz3w"],"children":[]}
{"id":"k746m3ok","parent_id":"bpb4f298","name":"Bun compile and CI","description":"Set up Bun binary compilation and GitHub Actions CI.\n\nBuild:\n- bun build src/cli/index.ts --compile --outfile dist/dotagents\n- Per-platform binaries: darwin-arm64, darwin-x64, linux-x64, linux-arm64\n\nGitHub Actions:\n- CI workflow: lint, typecheck, test on push/PR\n- Release workflow: build per-platform binaries, attach to GitHub Release\n- Install script (optional): curl-pipe-sh that detects platform and downloads binary\n\nnpm:\n- Package published with bin field pointing to dist/cli/index.js (JS fallback)\n- npx dotagents works for Node.js users\n\nAcceptance criteria:\n- bun build produces a working standalone binary\n- Binary works without Bun/Node.js installed\n- CI runs lint + typecheck + test on every push","priority":1,"completed":false,"result":null,"metadata":null,"created_at":"2026-02-07T18:00:02.720Z","updated_at":"2026-02-07T18:00:14.303Z","started_at":null,"completed_at":null,"blockedBy":["srnjavhs"],"blocks":[],"children":[]}
{"id":"qze9byy6","parent_id":"bpb4f298","name":"Skill resolution and git source","description":"Implement skill specifier parsing and git-based skill fetching.\n\nFiles to create:\n- src/skills/resolver.ts -- Parse source specifiers into ResolvedSource objects\n- src/sources/git.ts -- Clone/fetch git repos via git CLI\n- src/sources/local.ts -- Resolve path: sources relative to project root\n- src/sources/cache.ts -- Global cache at ~/.local/dotagents/cache/\n- src/utils/exec.ts -- Child process execution helper for non-interactive git commands\n- src/skills/loader.ts -- Parse SKILL.md files (YAML frontmatter + markdown body)\n\nResolution rules:\n- github:owner/repo/path -> https://github.com/owner/repo.git, subdirectory path/\n- git:url + path field -> full URL clone, use path for subdirectory\n- path:relative -> resolve relative to project root\n- @scope/name -> try github:scope/skills/name, fallback to github:scope/name\n\nCache structure: ~/.local/dotagents/cache/github.com/owner/repo/ (bare git repos)\n\nAcceptance criteria:\n- All 4 source types resolve correctly\n- Git clone works with --depth=1 for fresh clones\n- Cache is checked before network fetch\n- SKILL.md is validated (name + description required in frontmatter)","priority":1,"completed":false,"result":null,"metadata":null,"created_at":"2026-02-07T17:59:17.801Z","updated_at":"2026-02-07T18:00:08.470Z","started_at":null,"completed_at":null,"blockedBy":["iashsswc"],"blocks":["g6gl9kkc"],"children":[]}
{"id":"srnjavhs","parent_id":"bpb4f298","name":"Update, sync, and list commands","description":"Implement the remaining CLI commands: update, sync, list.\n\nFiles: src/cli/commands/update.ts, src/cli/commands/sync.ts, src/cli/commands/list.ts\n\ndotagents update [<name>]:\n- Branch refs: fetch latest commit\n- Tag refs: check for newer semver tags\n- Commit SHA refs: skip (immutable)\n- Update lockfile, re-install, print changelog\n\ndotagents sync:\n- Regenerate .agents/.gitignore\n- Verify/repair symlinks\n- Warn on managed skills accidentally in git\n- Warn on orphaned skills (installed but not in agents.toml)\n- Verify integrity hashes\n\ndotagents list [--json]:\n- Show each skill: name, source, installed commit (short SHA), status\n- Status: up to date, outdated, modified (integrity mismatch), custom (unmanaged)\n- --json for machine consumption\n\nAcceptance criteria:\n- update fetches new commits for branch-pinned skills\n- sync detects and reports drift\n- list shows accurate status for all skills","priority":1,"completed":false,"result":null,"metadata":null,"created_at":"2026-02-07T17:59:57.259Z","updated_at":"2026-02-07T18:00:13.465Z","started_at":null,"completed_at":null,"blockedBy":["ib51q4f3"],"blocks":["k746m3ok"],"children":[]}
